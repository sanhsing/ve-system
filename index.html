<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VE-System è™›æ“¾åœ°çƒç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); }
        .card-glow { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
        .star-glow { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .loading-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .correct { animation: correctPulse 0.5s; }
        @keyframes correctPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const API_BASE = 'https://ve-system.onrender.com';
        
        // ============ é€šç”¨çµ„ä»¶ ============
        
        const Loading = () => (
            <div className="flex items-center justify-center p-8">
                <div className="loading-spin text-4xl">âš™ï¸</div>
                <span className="ml-3 text-gray-400">è¼‰å…¥ä¸­...</span>
            </div>
        );
        
        const StatCard = ({ title, value, subtitle, icon }) => (
            <div className="bg-gray-800/50 backdrop-blur rounded-xl p-6 border border-gray-700 hover:border-indigo-500 transition-all">
                <div className="flex items-center justify-between">
                    <div>
                        <p className="text-gray-400 text-sm">{title}</p>
                        <p className="text-3xl font-bold mt-1">{value}</p>
                        {subtitle && <p className="text-gray-500 text-sm mt-1">{subtitle}</p>}
                    </div>
                    <div className="text-4xl opacity-80">{icon}</div>
                </div>
            </div>
        );
        
        const Navbar = ({ currentPage, setCurrentPage }) => {
            const navItems = [
                { id: 'dashboard', name: 'å„€è¡¨æ¿', icon: 'ğŸ“Š' },
                { id: 'qixing', name: 'åŒ—æ–—ä¸ƒæ˜Ÿ', icon: 'â­' },
                { id: 'databases', name: 'è³‡æ–™åº«', icon: 'ğŸ—„ï¸' },
                { id: 'trade', name: 'äº¤æ˜“ç³»çµ±', icon: 'ğŸ“ˆ' },
                { id: 'education', name: 'æ•™è‚²ç³»çµ±', icon: 'ğŸ“š' },
                { id: 've', name: 'è™›æ“¬åœ°çƒ', icon: 'ğŸŒ' },
            ];
            
            return (
                <nav className="bg-gray-900/50 backdrop-blur-md border-b border-gray-700 sticky top-0 z-50">
                    <div className="max-w-7xl mx-auto px-4">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex items-center space-x-2 cursor-pointer" onClick={() => setCurrentPage('dashboard')}>
                                <span className="text-2xl">ğŸŒŒ</span>
                                <span className="text-xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                                    VE-System
                                </span>
                            </div>
                            <div className="flex space-x-1 overflow-x-auto">
                                {navItems.map(item => (
                                    <button
                                        key={item.id}
                                        onClick={() => setCurrentPage(item.id)}
                                        className={`px-3 py-2 rounded-lg text-sm transition-all whitespace-nowrap ${
                                            currentPage === item.id
                                                ? 'bg-indigo-600 text-white'
                                                : 'text-gray-300 hover:bg-gray-700'
                                        }`}
                                    >
                                        <span className="mr-1">{item.icon}</span>
                                        <span className="hidden md:inline">{item.name}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </nav>
            );
        };
        
        // ============ å„€è¡¨æ¿ ============
        
        const Dashboard = () => {
            const [status, setStatus] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            
            useEffect(() => {
                fetch(`${API_BASE}/api/v1/status`)
                    .then(res => res.json())
                    .then(data => { setStatus(data); setLoading(false); })
                    .catch(err => { setError(err.message); setLoading(false); });
            }, []);
            
            if (loading) return <Loading />;
            if (error) return <div className="text-red-400 p-8">é€£ç·šéŒ¯èª¤: {error}</div>;
            
            return (
                <div className="space-y-6">
                    <div className="text-center py-8">
                        <h1 className="text-4xl font-bold bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                            è™›æ“¾åœ°çƒç³»çµ±
                        </h1>
                        <p className="text-gray-400 mt-2">Virtual Earth System</p>
                        <div className="mt-4 inline-flex items-center px-4 py-2 bg-green-900/50 rounded-full border border-green-500">
                            <span className="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                            <span className="text-green-400">ç³»çµ±é‹è¡Œä¸­</span>
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <StatCard title="ç³»çµ±æˆç†Ÿåº¦" value={status?.maturity || '90.7%'} subtitle="ç”¢å“ç´š" icon="ğŸ¯" />
                        <StatCard title="è³‡æ–™åº«" value={status?.totals?.databases || 9} subtitle="ä¹å®®æ ¼å±€" icon="ğŸ—„ï¸" />
                        <StatCard title="è³‡æ–™è¡¨" value={status?.totals?.tables?.toLocaleString()} subtitle="çµæ§‹å®Œæ•´" icon="ğŸ“‹" />
                        <StatCard title="è³‡æ–™ç­†æ•¸" value={status?.totals?.records?.toLocaleString()} subtitle="æŒçºŒç´¯ç©" icon="ğŸ“Š" />
                    </div>
                    
                    <div className="bg-gray-800/50 backdrop-blur rounded-xl p-6 border border-gray-700">
                        <h2 className="text-xl font-semibold mb-4">ğŸ—„ï¸ ä¹åº«çµ±è¨ˆ</h2>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {status?.databases && Object.entries(status.databases)
                                .sort((a, b) => (b[1].records || 0) - (a[1].records || 0))
                                .map(([name, db]) => (
                                <div key={name} className="bg-gray-900/50 rounded-lg p-4 border border-gray-600 hover:border-indigo-500 transition-all">
                                    <div className="flex justify-between items-center">
                                        <span className="font-medium text-indigo-400">{name}.db</span>
                                        <span className="text-xs text-gray-500">{db.tables} è¡¨</span>
                                    </div>
                                    <div className="mt-2">
                                        <div className="text-2xl font-bold">{(db.records || 0).toLocaleString()}</div>
                                        <div className="text-xs text-gray-500">ç­†è³‡æ–™</div>
                                    </div>
                                    <div className="mt-2 bg-gray-700 rounded-full h-2">
                                        <div 
                                            className="bg-gradient-to-r from-indigo-500 to-purple-500 h-2 rounded-full transition-all"
                                            style={{ width: `${Math.min((db.records || 0) / 1500, 100)}%` }}
                                        ></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };
        
        // ============ åŒ—æ–—ä¸ƒæ˜Ÿ ============
        
        const QiXing = () => {
            const [qixing, setQixing] = useState(null);
            const [loading, setLoading] = useState(true);
            const [selectedStar, setSelectedStar] = useState(null);
            
            useEffect(() => {
                fetch(`${API_BASE}/api/v1/qixing`)
                    .then(res => res.json())
                    .then(data => { setQixing(data); setLoading(false); })
                    .catch(() => setLoading(false));
            }, []);
            
            if (loading) return <Loading />;
            
            const starDetails = {
                'å…‰è˜Š': { desc: 'æŒç®¡ç³»çµ±é¡˜æ™¯èˆ‡æ ¸å¿ƒåƒ¹å€¼ï¼Œç¢ºä¿æ‰€æœ‰æ±ºç­–ç¬¦åˆé“çš„åŸå‰‡', color: 'from-yellow-400 to-orange-500' },
                'ç¹”æ˜': { desc: 'è² è²¬ç³»çµ±æ¶æ§‹è¨­è¨ˆï¼Œç·¨ç¹”å„æ¨¡çµ„é–“çš„é€£çµèˆ‡é—œä¿‚', color: 'from-blue-400 to-cyan-500' },
                'ç†æ¨': { desc: 'è™•ç†é‚è¼¯é‹ç®—èˆ‡æ¼”ç®—æ³•ï¼Œæ˜¯ç³»çµ±çš„æ™ºæ…§æ ¸å¿ƒ', color: 'from-purple-400 to-pink-500' },
                'æ¾„æ›¸': { desc: 'æ²‰æ¾±çŸ¥è­˜èˆ‡æ–‡æª”ï¼Œå»ºç«‹ç³»çµ±çš„è¨˜æ†¶èˆ‡å‚³æ‰¿', color: 'from-green-400 to-teal-500' },
                'æµç¥‡': { desc: 'å„ªåŒ–æµç¨‹èˆ‡æ•ˆç‡ï¼Œç¢ºä¿ç³»çµ±é †æš¢é‹è¡Œ', color: 'from-red-400 to-rose-500' },
                'æ˜Ÿæ®¼': { desc: 'å‘ˆç¾ä½¿ç”¨è€…ä»‹é¢ï¼Œæ˜¯ç³»çµ±èˆ‡å¤–ç•Œçš„æ¥è§¸é¢', color: 'from-indigo-400 to-violet-500' },
                'ç’ƒèª': { desc: 'è™•ç†æºé€šèˆ‡ç¿»è­¯ï¼Œé€£æ¥ä¸åŒç³»çµ±èˆ‡ä½¿ç”¨è€…', color: 'from-amber-400 to-yellow-500' },
            };
            
            return (
                <div className="space-y-6">
                    <div className="text-center py-4">
                        <h1 className="text-3xl font-bold">â­ åŒ—æ–—ä¸ƒæ˜Ÿå”ä½œé«”ç³»</h1>
                        <p className="text-gray-400 mt-2">ä¸ƒæ˜Ÿå°é½Šç‡: {qixing?.alignment}</p>
                    </div>
                    
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700">
                            <h3 className="text-lg font-semibold mb-4">é¸æ“‡ä¸€é¡†æ˜Ÿ</h3>
                            <div className="grid grid-cols-2 gap-3">
                                {qixing?.stars?.map(star => (
                                    <button
                                        key={star.id}
                                        onClick={() => setSelectedStar(star)}
                                        className={`p-4 rounded-lg border transition-all text-left ${
                                            selectedStar?.id === star.id
                                                ? 'bg-indigo-600 border-indigo-400'
                                                : 'bg-gray-900/50 border-gray-600 hover:border-indigo-500'
                                        }`}
                                    >
                                        <div className="flex items-center space-x-2">
                                            <span className="text-2xl star-glow">â­</span>
                                            <div>
                                                <div className="font-bold">{star.name}</div>
                                                <div className="text-sm text-gray-400">{star.role}</div>
                                            </div>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </div>
                        
                        <div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700">
                            {selectedStar ? (
                                <div className="space-y-4">
                                    <div className={`text-center p-6 rounded-lg bg-gradient-to-r ${starDetails[selectedStar.name]?.color} bg-opacity-20`}>
                                        <div className="text-6xl mb-4">â­</div>
                                        <h2 className="text-2xl font-bold">{selectedStar.name}</h2>
                                        <p className="text-lg text-gray-300">{selectedStar.role}</p>
                                    </div>
                                    <div className="p-4 bg-gray-900/50 rounded-lg">
                                        <h4 className="font-semibold mb-2">è·è²¬èªªæ˜</h4>
                                        <p className="text-gray-400">{starDetails[selectedStar.name]?.desc}</p>
                                    </div>
                                    <div className="flex items-center justify-between p-4 bg-gray-900/50 rounded-lg">
                                        <span>ç‹€æ…‹</span>
                                        <span className="flex items-center text-green-400">
                                            <span className="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                                            é‹è¡Œä¸­
                                        </span>
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center text-gray-500 py-20">
                                    â† é»æ“Šé¸æ“‡ä¸€é¡†æ˜ŸæŸ¥çœ‹è©³æƒ…
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        // ============ è³‡æ–™åº«ç€è¦½å™¨ ============
        
        const Databases = () => {
            const [selectedDb, setSelectedDb] = useState(null);
            const [tables, setTables] = useState([]);
            const [selectedTable, setSelectedTable] = useState(null);
            const [tableData, setTableData] = useState(null);
            const [loading, setLoading] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            
            const databases = ['meta', 've', 'trade', 'education', 'business', 'clarity', 'corpus', 'taoist', 'work'];
            
            const loadTables = async (db) => {
                setLoading(true);
                setSelectedDb(db);
                setSelectedTable(null);
                setTableData(null);
                try {
                    const res = await fetch(`${API_BASE}/api/v1/db/${db}/tables`);
                    const data = await res.json();
                    setTables(data.tables || []);
                } catch (err) { console.error(err); }
                setLoading(false);
            };
            
            const loadTableData = async (table) => {
                setLoading(true);
                setSelectedTable(table);
                try {
                    const res = await fetch(`${API_BASE}/api/v1/db/${selectedDb}/table/${table}?limit=20`);
                    const data = await res.json();
                    setTableData(data);
                } catch (err) { console.error(err); }
                setLoading(false);
            };
            
            const filteredTables = tables.filter(t => t.toLowerCase().includes(searchTerm.toLowerCase()));
            
            return (
                <div className="space-y-6">
                    <h1 className="text-3xl font-bold">ğŸ—„ï¸ è³‡æ–™åº«ç€è¦½å™¨</h1>
                    
                    <div className="flex flex-wrap gap-2">
                        {databases.map(db => (
                            <button
                                key={db}
                                onClick={() => loadTables(db)}
                                className={`px-4 py-2 rounded-lg transition-all ${
                                    selectedDb === db ? 'bg-indigo-600 text-white' : 'bg-gray-800 text-gray-300 hover:bg-gray-700'
                                }`}
                            >
                                {db}.db
                            </button>
                        ))}
                    </div>
                    
                    {selectedDb && (
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div className="bg-gray-800/50 rounded-xl p-4 border border-gray-700">
                                <div className="mb-3">
                                    <input
                                        type="text"
                                        placeholder="æœå°‹è³‡æ–™è¡¨..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full px-3 py-2 bg-gray-900 border border-gray-600 rounded-lg text-sm focus:border-indigo-500 outline-none"
                                    />
                                </div>
                                <h3 className="font-semibold mb-2 text-indigo-400">
                                    {selectedDb}.db ({filteredTables.length} è¡¨)
                                </h3>
                                <div className="space-y-1 max-h-[500px] overflow-y-auto">
                                    {loading && !tableData ? <Loading /> : filteredTables.map(table => (
                                        <button
                                            key={table}
                                            onClick={() => loadTableData(table)}
                                            className={`w-full text-left px-3 py-2 rounded text-sm transition-all ${
                                                selectedTable === table ? 'bg-indigo-600 text-white' : 'text-gray-300 hover:bg-gray-700'
                                            }`}
                                        >
                                            {table}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="lg:col-span-3 bg-gray-800/50 rounded-xl p-4 border border-gray-700 overflow-hidden">
                                {loading && selectedTable ? <Loading /> : tableData ? (
                                    <div>
                                        <div className="flex justify-between items-center mb-3">
                                            <h3 className="font-semibold text-indigo-400">
                                                {selectedTable}
                                            </h3>
                                            <span className="text-sm text-gray-500">
                                                å…± {tableData.pagination?.total?.toLocaleString()} ç­†
                                            </span>
                                        </div>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm">
                                                <thead>
                                                    <tr className="border-b border-gray-700">
                                                        {tableData.columns?.slice(0, 6).map(col => (
                                                            <th key={col} className="text-left p-2 text-gray-400 whitespace-nowrap">{col}</th>
                                                        ))}
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {tableData.data?.map((row, i) => (
                                                        <tr key={i} className="border-b border-gray-800 hover:bg-gray-700/50">
                                                            {tableData.columns?.slice(0, 6).map(col => (
                                                                <td key={col} className="p-2 max-w-[200px] truncate">
                                                                    {typeof row[col] === 'object' 
                                                                        ? JSON.stringify(row[col]).substring(0, 30) + '...'
                                                                        : String(row[col] ?? '').substring(0, 50)}
                                                                </td>
                                                            ))}
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="text-center text-gray-500 py-20">â† é¸æ“‡ä¸€å€‹è³‡æ–™è¡¨æŸ¥çœ‹å…§å®¹</div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        // ============ æ•™è‚²ç³»çµ± ============
        
        const Education = () => {
            const [questions, setQuestions] = useState([]);
            const [currentQ, setCurrentQ] = useState(0);
            const [selected, setSelected] = useState(null);
            const [result, setResult] = useState(null);
            const [score, setScore] = useState({ correct: 0, total: 0 });
            const [loading, setLoading] = useState(true);
            const [gameStarted, setGameStarted] = useState(false);
            
            const loadQuestions = async () => {
                setLoading(true);
                try {
                    const res = await fetch(`${API_BASE}/api/v1/education/questions?limit=10`);
                    const data = await res.json();
                    setQuestions(data.questions || []);
                    setCurrentQ(0);
                    setScore({ correct: 0, total: 0 });
                    setSelected(null);
                    setResult(null);
                } catch (err) { console.error(err); }
                setLoading(false);
            };
            
            const checkAnswer = async (answer) => {
                if (result) return;
                setSelected(answer);
                
                try {
                    const res = await fetch(`${API_BASE}/api/v1/education/check`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            question_id: questions[currentQ].question_id,
                            answer: answer
                        })
                    });
                    const data = await res.json();
                    setResult(data);
                    setScore(prev => ({
                        correct: prev.correct + (data.correct ? 1 : 0),
                        total: prev.total + 1
                    }));
                } catch (err) { console.error(err); }
            };
            
            const nextQuestion = () => {
                if (currentQ < questions.length - 1) {
                    setCurrentQ(prev => prev + 1);
                    setSelected(null);
                    setResult(null);
                }
            };
            
            if (!gameStarted) {
                return (
                    <div className="space-y-6">
                        <h1 className="text-3xl font-bold">ğŸ“š æ•™è‚²ç³»çµ±</h1>
                        <div className="bg-gray-800/50 rounded-xl p-8 border border-gray-700 text-center">
                            <div className="text-6xl mb-4">ğŸ“</div>
                            <h2 className="text-2xl font-bold mb-2">çŸ¥è­˜æŒ‘æˆ°</h2>
                            <p className="text-gray-400 mb-6">æ¸¬è©¦ä½ çš„å­¸ç§‘çŸ¥è­˜ï¼Œæ¶µè“‹æ•¸å­¸ã€åœ‹æ–‡ã€è‹±æ–‡ã€ç†åŒ–ç­‰ç§‘ç›®</p>
                            <div className="grid grid-cols-3 gap-4 mb-6 max-w-md mx-auto">
                                <div className="bg-gray-900/50 p-4 rounded-lg">
                                    <div className="text-2xl font-bold text-indigo-400">107</div>
                                    <div className="text-sm text-gray-500">é¡Œåº«ç¸½æ•¸</div>
                                </div>
                                <div className="bg-gray-900/50 p-4 rounded-lg">
                                    <div className="text-2xl font-bold text-green-400">9</div>
                                    <div className="text-sm text-gray-500">å­¸ç§‘</div>
                                </div>
                                <div className="bg-gray-900/50 p-4 rounded-lg">
                                    <div className="text-2xl font-bold text-yellow-400">10</div>
                                    <div className="text-sm text-gray-500">æ¯å›åˆé¡Œæ•¸</div>
                                </div>
                            </div>
                            <button
                                onClick={() => { setGameStarted(true); loadQuestions(); }}
                                className="px-8 py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-semibold transition-all"
                            >
                                é–‹å§‹æŒ‘æˆ° ğŸš€
                            </button>
                        </div>
                    </div>
                );
            }
            
            if (loading) return <Loading />;
            
            const q = questions[currentQ];
            if (!q) return <div className="text-center p-8">æ²’æœ‰é¡Œç›®</div>;
            
            const options = Array.isArray(q.options) ? q.options : [];
            
            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl font-bold">ğŸ“š çŸ¥è­˜æŒ‘æˆ°</h1>
                        <div className="flex items-center space-x-4">
                            <span className="text-gray-400">å¾—åˆ†: <span className="text-green-400 font-bold">{score.correct}</span>/{score.total}</span>
                            <span className="text-gray-400">é¡Œç›®: {currentQ + 1}/{questions.length}</span>
                        </div>
                    </div>
                    
                    <div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700">
                        <div className="mb-2 text-sm text-indigo-400">{q.subject}</div>
                        <h2 className="text-xl mb-6">{q.question_text}</h2>
                        
                        <div className="space-y-3">
                            {options.map((opt, i) => {
                                const letter = opt.charAt(0);
                                const isSelected = selected === letter;
                                const isCorrect = result?.correct_answer === letter;
                                const isWrong = isSelected && !result?.correct;
                                
                                let btnClass = 'bg-gray-900/50 border-gray-600 hover:border-indigo-500';
                                if (result) {
                                    if (isCorrect) btnClass = 'bg-green-900/50 border-green-500';
                                    else if (isWrong) btnClass = 'bg-red-900/50 border-red-500 shake';
                                }
                                
                                return (
                                    <button
                                        key={i}
                                        onClick={() => checkAnswer(letter)}
                                        disabled={result !== null}
                                        className={`w-full text-left p-4 rounded-lg border transition-all ${btnClass}`}
                                    >
                                        {opt}
                                    </button>
                                );
                            })}
                        </div>
                        
                        {result && (
                            <div className={`mt-6 p-4 rounded-lg ${result.correct ? 'bg-green-900/30 border border-green-600' : 'bg-red-900/30 border border-red-600'}`}>
                                <div className="font-bold mb-2">
                                    {result.correct ? 'âœ… ç­”å°äº†ï¼' : `âŒ ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${result.correct_answer}`}
                                </div>
                                {q.explanation && <p className="text-gray-400 text-sm">{q.explanation}</p>}
                            </div>
                        )}
                        
                        {result && currentQ < questions.length - 1 && (
                            <button
                                onClick={nextQuestion}
                                className="mt-4 w-full py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-semibold"
                            >
                                ä¸‹ä¸€é¡Œ â†’
                            </button>
                        )}
                        
                        {result && currentQ === questions.length - 1 && (
                            <div className="mt-6 text-center">
                                <div className="text-2xl font-bold mb-2">ğŸ‰ æŒ‘æˆ°å®Œæˆï¼</div>
                                <div className="text-xl">æœ€çµ‚å¾—åˆ†: <span className="text-green-400">{score.correct}</span> / {score.total}</div>
                                <button
                                    onClick={loadQuestions}
                                    className="mt-4 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg"
                                >
                                    å†ç©ä¸€æ¬¡
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };
        
        // ============ äº¤æ˜“ç³»çµ± ============
        
        const Trade = () => {
            const [strategies, setStrategies] = useState([]);
            const [indicators, setIndicators] = useState([]);
            const [tab, setTab] = useState('strategies');
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                Promise.all([
                    fetch(`${API_BASE}/api/v1/trade/strategies`).then(r => r.json()),
                    fetch(`${API_BASE}/api/v1/trade/indicators`).then(r => r.json())
                ]).then(([strat, ind]) => {
                    setStrategies(strat.strategies || []);
                    setIndicators(ind.indicators || []);
                    setLoading(false);
                }).catch(() => setLoading(false));
            }, []);
            
            if (loading) return <Loading />;
            
            return (
                <div className="space-y-6">
                    <h1 className="text-3xl font-bold">ğŸ“ˆ äº¤æ˜“ç³»çµ±</h1>
                    
                    <div className="flex space-x-2">
                        <button onClick={() => setTab('strategies')} className={`px-4 py-2 rounded-lg ${tab === 'strategies' ? 'bg-indigo-600' : 'bg-gray-800 hover:bg-gray-700'}`}>
                            ğŸ“Š ç­–ç•¥åº« ({strategies.length})
                        </button>
                        <button onClick={() => setTab('indicators')} className={`px-4 py-2 rounded-lg ${tab === 'indicators' ? 'bg-indigo-600' : 'bg-gray-800 hover:bg-gray-700'}`}>
                            ğŸ“‰ æŠ€è¡“æŒ‡æ¨™ ({indicators.length})
                        </button>
                    </div>
                    
                    {tab === 'strategies' && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {strategies.map((s, i) => (
                                <div key={i} className="bg-gray-800/50 rounded-xl p-4 border border-gray-700 hover:border-indigo-500 transition-all">
                                    <h3 className="font-bold text-indigo-400">{s.strategy_name || s.name}</h3>
                                    <p className="text-sm text-gray-400 mt-1">{s.description?.substring(0, 100)}...</p>
                                    <div className="mt-2 flex flex-wrap gap-2">
                                        {s.category && <span className="px-2 py-1 bg-gray-700 rounded text-xs">{s.category}</span>}
                                        {s.risk_level && <span className="px-2 py-1 bg-yellow-900/50 text-yellow-400 rounded text-xs">é¢¨éšª: {s.risk_level}</span>}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                    
                    {tab === 'indicators' && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {indicators.map((ind, i) => (
                                <div key={i} className="bg-gray-800/50 rounded-xl p-4 border border-gray-700">
                                    <h3 className="font-bold text-green-400">{ind.indicator_name || ind.name}</h3>
                                    <p className="text-xs text-gray-500 mt-1">{ind.category}</p>
                                    {ind.formula && <code className="block mt-2 text-xs bg-gray-900 p-2 rounded overflow-x-auto">{ind.formula}</code>}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };
        
        // ============ è™›æ“¬åœ°çƒ ============
        
        const VirtualEarth = () => {
            const [quests, setQuests] = useState([]);
            const [shop, setShop] = useState([]);
            const [tab, setTab] = useState('quests');
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                Promise.all([
                    fetch(`${API_BASE}/api/v1/ve/quests`).then(r => r.json()),
                    fetch(`${API_BASE}/api/v1/ve/shop`).then(r => r.json())
                ]).then(([q, s]) => {
                    setQuests(q.quests || []);
                    setShop(s.items || []);
                    setLoading(false);
                }).catch(() => setLoading(false));
            }, []);
            
            if (loading) return <Loading />;
            
            return (
                <div className="space-y-6">
                    <h1 className="text-3xl font-bold">ğŸŒ è™›æ“¬åœ°çƒ - E18K é˜²è©éŠæˆ²</h1>
                    
                    <div className="flex space-x-2">
                        <button onClick={() => setTab('quests')} className={`px-4 py-2 rounded-lg ${tab === 'quests' ? 'bg-indigo-600' : 'bg-gray-800 hover:bg-gray-700'}`}>
                            ğŸ¯ ä»»å‹™ ({quests.length})
                        </button>
                        <button onClick={() => setTab('shop')} className={`px-4 py-2 rounded-lg ${tab === 'shop' ? 'bg-indigo-600' : 'bg-gray-800 hover:bg-gray-700'}`}>
                            ğŸª å•†åº— ({shop.length})
                        </button>
                    </div>
                    
                    {tab === 'quests' && (
                        <div className="space-y-4">
                            {quests.map((q, i) => (
                                <div key={i} className="bg-gray-800/50 rounded-xl p-4 border border-gray-700 hover:border-indigo-500 transition-all">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h3 className="font-bold text-indigo-400">{q.quest_id}: {q.quest_name}</h3>
                                            <p className="text-sm text-gray-400 mt-1">é›£åº¦: {q.difficulty}</p>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-yellow-400">ğŸ† {q.exp_reward} EXP</div>
                                            <div className="text-yellow-500">ğŸ’° {q.gold_reward} Gold</div>
                                        </div>
                                    </div>
                                    {q.item_reward && (
                                        <div className="mt-2 text-sm text-green-400">ğŸ çå‹µ: {q.item_reward}</div>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                    
                    {tab === 'shop' && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {shop.map((item, i) => (
                                <div key={i} className="bg-gray-800/50 rounded-xl p-4 border border-gray-700 hover:border-yellow-500 transition-all">
                                    <h3 className="font-bold text-yellow-400">{item.item_name}</h3>
                                    <p className="text-sm text-gray-400 mt-1">{item.description}</p>
                                    <div className="mt-3 flex justify-between items-center">
                                        <span className="text-yellow-500 font-bold">ğŸ’° {item.price} Gold</span>
                                        <button className="px-3 py-1 bg-yellow-600 hover:bg-yellow-700 rounded text-sm">
                                            è³¼è²·
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };
        
        // ============ ä¸»æ‡‰ç”¨ ============
        
        const App = () => {
            const [currentPage, setCurrentPage] = useState('dashboard');
            
            const renderPage = () => {
                switch (currentPage) {
                    case 'dashboard': return <Dashboard />;
                    case 'qixing': return <QiXing />;
                    case 'databases': return <Databases />;
                    case 'trade': return <Trade />;
                    case 'education': return <Education />;
                    case 've': return <VirtualEarth />;
                    default: return <Dashboard />;
                }
            };
            
            return (
                <div className="min-h-screen">
                    <Navbar currentPage={currentPage} setCurrentPage={setCurrentPage} />
                    <main className="max-w-7xl mx-auto px-4 py-8">
                        {renderPage()}
                    </main>
                    <footer className="text-center py-6 text-gray-500 text-sm border-t border-gray-800">
                        <p>VE-System v1.0.0 | åŒ—æ–—ä¸ƒæ˜Ÿæ–‡å‰µæ•¸ä½æœ‰é™å…¬å¸</p>
                        <p className="mt-1">é“çš„1%åŸå‰‡ Â· æ—¥æ‹±ä¸€å’</p>
                    </footer>
                </div>
            );
        };
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
