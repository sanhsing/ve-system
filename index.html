<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VE-System è™›æ“¾åœ°çƒç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); }
        .star-glow { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .loading-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .bounce { animation: bounce 0.5s; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .fade-in { animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .progress-bar { transition: width 0.5s ease; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_BASE = 'https://ve-system.onrender.com';
        
        const Loading = () => (<div className="flex items-center justify-center p-8"><div className="loading-spin text-4xl">âš™ï¸</div><span className="ml-3 text-gray-400">è¼‰å…¥ä¸­...</span></div>);
        const StatCard = ({ title, value, subtitle, icon }) => (<div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700 hover:border-indigo-500 transition-all"><div className="flex items-center justify-between"><div><p className="text-gray-400 text-sm">{title}</p><p className="text-3xl font-bold mt-1">{value}</p>{subtitle && <p className="text-gray-500 text-sm mt-1">{subtitle}</p>}</div><div className="text-4xl opacity-80">{icon}</div></div></div>);
        const Modal = ({ isOpen, onClose, title, children }) => { if (!isOpen) return null; return (<div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={onClose}><div className="bg-gray-800 rounded-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto border border-gray-600 fade-in" onClick={e => e.stopPropagation()}><div className="sticky top-0 bg-gray-800 p-4 border-b border-gray-700 flex justify-between items-center"><h2 className="text-xl font-bold">{title}</h2><button onClick={onClose} className="text-gray-400 hover:text-white text-2xl">&times;</button></div><div className="p-4">{children}</div></div></div>); };
        
        const Navbar = ({ currentPage, setCurrentPage }) => {
            const navItems = [{ id: 'dashboard', name: 'å„€è¡¨æ¿', icon: 'ğŸ“Š' },{ id: 'qixing', name: 'åŒ—æ–—ä¸ƒæ˜Ÿ', icon: 'â­' },{ id: 'databases', name: 'è³‡æ–™åº«', icon: 'ğŸ—„ï¸' },{ id: 'trade', name: 'äº¤æ˜“ç³»çµ±', icon: 'ğŸ“ˆ' },{ id: 'education', name: 'æ•™è‚²ç³»çµ±', icon: 'ğŸ“š' },{ id: 've', name: 'è™›æ“¬åœ°çƒ', icon: 'ğŸŒ' }];
            return (<nav className="bg-gray-900/50 backdrop-blur-md border-b border-gray-700 sticky top-0 z-50"><div className="max-w-7xl mx-auto px-4"><div className="flex items-center justify-between h-16"><div className="flex items-center space-x-2 cursor-pointer" onClick={() => setCurrentPage('dashboard')}><span className="text-2xl">ğŸŒŒ</span><span className="text-xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">VE-System</span></div><div className="flex space-x-1 overflow-x-auto">{navItems.map(item => (<button key={item.id} onClick={() => setCurrentPage(item.id)} className={`px-3 py-2 rounded-lg text-sm transition-all ${currentPage === item.id ? 'bg-indigo-600' : 'text-gray-300 hover:bg-gray-700'}`}><span className="mr-1">{item.icon}</span><span className="hidden md:inline">{item.name}</span></button>))}</div></div></div></nav>);
        };
        
        const Dashboard = () => {
            const [status, setStatus] = useState(null);
            const [loading, setLoading] = useState(true);
            useEffect(() => { fetch(`${API_BASE}/api/v1/status`).then(r => r.json()).then(d => { setStatus(d); setLoading(false); }).catch(() => setLoading(false)); }, []);
            if (loading) return <Loading />;
            return (<div className="space-y-6"><div className="text-center py-8"><h1 className="text-4xl font-bold bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">è™›æ“¾åœ°çƒç³»çµ±</h1><p className="text-gray-400 mt-2">Virtual Earth System</p><div className="mt-4 inline-flex items-center px-4 py-2 bg-green-900/50 rounded-full border border-green-500"><span className="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span><span className="text-green-400">ç³»çµ±é‹è¡Œä¸­</span></div></div><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"><StatCard title="ç³»çµ±æˆç†Ÿåº¦" value={status?.maturity || '90.7%'} subtitle="ç”¢å“ç´š" icon="ğŸ¯" /><StatCard title="è³‡æ–™åº«" value={status?.totals?.databases || 9} subtitle="ä¹å®®æ ¼å±€" icon="ğŸ—„ï¸" /><StatCard title="è³‡æ–™è¡¨" value={status?.totals?.tables?.toLocaleString()} subtitle="çµæ§‹å®Œæ•´" icon="ğŸ“‹" /><StatCard title="è³‡æ–™ç­†æ•¸" value={status?.totals?.records?.toLocaleString()} subtitle="æŒçºŒç´¯ç©" icon="ğŸ“Š" /></div><div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700"><h2 className="text-xl font-semibold mb-4">ğŸ—„ï¸ ä¹åº«çµ±è¨ˆ</h2><div className="grid grid-cols-1 md:grid-cols-3 gap-4">{status?.databases && Object.entries(status.databases).sort((a, b) => (b[1].records || 0) - (a[1].records || 0)).map(([name, db]) => (<div key={name} className="bg-gray-900/50 rounded-lg p-4 border border-gray-600"><div className="flex justify-between"><span className="text-indigo-400">{name}.db</span><span className="text-xs text-gray-500">{db.tables} è¡¨</span></div><div className="text-2xl font-bold mt-2">{(db.records || 0).toLocaleString()}</div><div className="mt-2 bg-gray-700 rounded-full h-2"><div className="bg-indigo-500 h-2 rounded-full progress-bar" style={{ width: `${Math.min((db.records || 0) / 1500, 100)}%` }}></div></div></div>))}</div></div></div>);
        };
        
        const QiXing = () => {
            const [qixing, setQixing] = useState(null);
            const [loading, setLoading] = useState(true);
            const [selectedStar, setSelectedStar] = useState(null);
            useEffect(() => { fetch(`${API_BASE}/api/v1/qixing`).then(r => r.json()).then(d => { setQixing(d); setLoading(false); }).catch(() => setLoading(false)); }, []);
            if (loading) return <Loading />;
            const starDetails = { 'å…‰è˜Š': { desc: 'æŒç®¡ç³»çµ±é¡˜æ™¯èˆ‡æ ¸å¿ƒåƒ¹å€¼', color: 'from-yellow-400 to-orange-500' }, 'ç¹”æ˜': { desc: 'è² è²¬ç³»çµ±æ¶æ§‹è¨­è¨ˆ', color: 'from-blue-400 to-cyan-500' }, 'ç†æ¨': { desc: 'è™•ç†é‚è¼¯é‹ç®—èˆ‡æ¼”ç®—æ³•', color: 'from-purple-400 to-pink-500' }, 'æ¾„æ›¸': { desc: 'æ²‰æ¾±çŸ¥è­˜èˆ‡æ–‡æª”', color: 'from-green-400 to-teal-500' }, 'æµç¥‡': { desc: 'å„ªåŒ–æµç¨‹èˆ‡æ•ˆç‡', color: 'from-red-400 to-rose-500' }, 'æ˜Ÿæ®¼': { desc: 'å‘ˆç¾ä½¿ç”¨è€…ä»‹é¢', color: 'from-indigo-400 to-violet-500' }, 'ç’ƒèª': { desc: 'è™•ç†æºé€šèˆ‡ç¿»è­¯', color: 'from-amber-400 to-yellow-500' } };
            return (<div className="space-y-6"><div className="text-center py-4"><h1 className="text-3xl font-bold">â­ åŒ—æ–—ä¸ƒæ˜Ÿå”ä½œé«”ç³»</h1><p className="text-gray-400 mt-2">å°é½Šç‡: {qixing?.alignment}</p></div><div className="grid grid-cols-1 lg:grid-cols-2 gap-6"><div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700"><h3 className="font-semibold mb-4">é¸æ“‡ä¸€é¡†æ˜Ÿ</h3><div className="grid grid-cols-2 gap-3">{qixing?.stars?.map(star => (<button key={star.id} onClick={() => setSelectedStar(star)} className={`p-4 rounded-lg border text-left ${selectedStar?.id === star.id ? 'bg-indigo-600 border-indigo-400' : 'bg-gray-900/50 border-gray-600 hover:border-indigo-500'}`}><div className="flex items-center gap-2"><span className="text-2xl">â­</span><div><div className="font-bold">{star.name}</div><div className="text-sm text-gray-400">{star.role}</div></div></div></button>))}</div></div><div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700">{selectedStar ? (<div className="space-y-4 fade-in"><div className={`text-center p-6 rounded-lg bg-gradient-to-r ${starDetails[selectedStar.name]?.color}`}><div className="text-6xl mb-4">â­</div><h2 className="text-2xl font-bold">{selectedStar.name}</h2><p>{selectedStar.role}</p></div><div className="p-4 bg-gray-900/50 rounded-lg"><h4 className="font-semibold mb-2">è·è²¬</h4><p className="text-gray-400">{starDetails[selectedStar.name]?.desc}</p></div></div>) : (<div className="text-center text-gray-500 py-20">â† é»æ“Šé¸æ“‡æ˜Ÿ</div>)}</div></div></div>);
        };
        
        const Databases = () => {
            const [selectedDb, setSelectedDb] = useState(null);
            const [tables, setTables] = useState([]);
            const [selectedTable, setSelectedTable] = useState(null);
            const [tableData, setTableData] = useState(null);
            const [loading, setLoading] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const databases = ['meta', 've', 'trade', 'education', 'business', 'clarity', 'corpus', 'taoist', 'work'];
            const loadTables = async (db) => { setLoading(true); setSelectedDb(db); setSelectedTable(null); setTableData(null); try { const res = await fetch(`${API_BASE}/api/v1/db/${db}/tables`); const data = await res.json(); setTables(data.tables || []); } catch (e) {} setLoading(false); };
            const loadTableData = async (table) => { setLoading(true); setSelectedTable(table); try { const res = await fetch(`${API_BASE}/api/v1/db/${selectedDb}/table/${table}?limit=20`); const data = await res.json(); setTableData(data); } catch (e) {} setLoading(false); };
            const filteredTables = tables.filter(t => t.toLowerCase().includes(searchTerm.toLowerCase()));
            return (<div className="space-y-6"><h1 className="text-3xl font-bold">ğŸ—„ï¸ è³‡æ–™åº«ç€è¦½å™¨</h1><div className="flex flex-wrap gap-2">{databases.map(db => (<button key={db} onClick={() => loadTables(db)} className={`px-4 py-2 rounded-lg ${selectedDb === db ? 'bg-indigo-600' : 'bg-gray-800 hover:bg-gray-700'}`}>{db}.db</button>))}</div>{selectedDb && (<div className="grid grid-cols-1 lg:grid-cols-4 gap-6"><div className="bg-gray-800/50 rounded-xl p-4 border border-gray-700"><input type="text" placeholder="æœå°‹..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full px-3 py-2 bg-gray-900 border border-gray-600 rounded-lg text-sm mb-3" /><h3 className="font-semibold mb-2 text-indigo-400">{selectedDb}.db ({filteredTables.length})</h3><div className="space-y-1 max-h-[500px] overflow-y-auto">{filteredTables.map(table => (<button key={table} onClick={() => loadTableData(table)} className={`w-full text-left px-3 py-2 rounded text-sm ${selectedTable === table ? 'bg-indigo-600' : 'hover:bg-gray-700'}`}>{table}</button>))}</div></div><div className="lg:col-span-3 bg-gray-800/50 rounded-xl p-4 border border-gray-700">{loading ? <Loading /> : tableData ? (<div className="fade-in"><div className="flex justify-between mb-3"><h3 className="font-semibold text-indigo-400">{selectedTable}</h3><span className="text-sm text-gray-500">å…± {tableData.pagination?.total?.toLocaleString()} ç­†</span></div><div className="overflow-x-auto"><table className="w-full text-sm"><thead><tr className="border-b border-gray-700">{tableData.columns?.slice(0, 6).map(col => (<th key={col} className="text-left p-2 text-gray-400">{col}</th>))}</tr></thead><tbody>{tableData.data?.map((row, i) => (<tr key={i} className="border-b border-gray-800 hover:bg-gray-700/50">{tableData.columns?.slice(0, 6).map(col => (<td key={col} className="p-2 max-w-[200px] truncate">{String(row[col] ?? '').substring(0, 50)}</td>))}</tr>))}</tbody></table></div></div>) : (<div className="text-center text-gray-500 py-20">â† é¸æ“‡è³‡æ–™è¡¨</div>)}</div></div>)}</div>);
        };

        const Education = () => {
            const [mode, setMode] = useState('menu');
            const [questions, setQuestions] = useState([]);
            const [currentQ, setCurrentQ] = useState(0);
            const [selected, setSelected] = useState(null);
            const [result, setResult] = useState(null);
            const [score, setScore] = useState({ correct: 0, total: 0, streak: 0, maxStreak: 0 });
            const [loading, setLoading] = useState(false);
            const [subject, setSubject] = useState('all');
            const [questionCount, setQuestionCount] = useState(10);
            const [history, setHistory] = useState([]);
            const [timeLeft, setTimeLeft] = useState(30);
            const [timerActive, setTimerActive] = useState(false);

            const subjects = [{ id: 'all', name: 'å…¨éƒ¨ç§‘ç›®', icon: 'ğŸ“š' },{ id: 'æ•¸å­¸', name: 'æ•¸å­¸', icon: 'ğŸ”¢' },{ id: 'åœ‹æ–‡', name: 'åœ‹æ–‡', icon: 'ğŸ“–' },{ id: 'è‹±æ–‡', name: 'è‹±æ–‡', icon: 'ğŸ”¤' },{ id: 'è‡ªç„¶', name: 'è‡ªç„¶ç§‘å­¸', icon: 'ğŸ”¬' },{ id: 'ç¤¾æœƒ', name: 'ç¤¾æœƒ', icon: 'ğŸŒ' }];

            useEffect(() => { if (timerActive && timeLeft > 0) { const t = setTimeout(() => setTimeLeft(v => v - 1), 1000); return () => clearTimeout(t); } else if (timeLeft === 0 && timerActive) { handleTimeout(); } }, [timeLeft, timerActive]);
            const handleTimeout = () => { setTimerActive(false); setResult({ correct: false, correct_answer: questions[currentQ]?.answer, timeout: true }); setScore(p => ({ ...p, total: p.total + 1, streak: 0 })); setHistory(p => [...p, { ...questions[currentQ], correct: false }]); };
            
            const loadQuestions = async () => {
                setLoading(true);
                try {
                    const url = subject === 'all' ? `${API_BASE}/api/v1/education/questions?limit=${questionCount}` : `${API_BASE}/api/v1/education/questions?limit=${questionCount}&subject=${subject}`;
                    const res = await fetch(url);
                    const data = await res.json();
                    if (data.questions?.length > 0) {
                        setQuestions(data.questions); setCurrentQ(0); setScore({ correct: 0, total: 0, streak: 0, maxStreak: 0 }); setSelected(null); setResult(null); setHistory([]); setMode('quiz'); setTimeLeft(30); setTimerActive(true);
                    } else { alert('æ­¤ç§‘ç›®æ²’æœ‰é¡Œç›®ï¼Œè«‹é¸å…¶ä»–ç§‘ç›®'); }
                } catch (e) { alert('è¼‰å…¥å¤±æ•—'); }
                setLoading(false);
            };
            
            const checkAnswer = async (answer) => {
                if (result) return;
                setSelected(answer); setTimerActive(false);
                try {
                    const res = await fetch(`${API_BASE}/api/v1/education/check`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ question_id: questions[currentQ].question_id, answer }) });
                    const data = await res.json();
                    setResult(data);
                    const newStreak = data.correct ? score.streak + 1 : 0;
                    setScore(p => ({ correct: p.correct + (data.correct ? 1 : 0), total: p.total + 1, streak: newStreak, maxStreak: Math.max(p.maxStreak, newStreak) }));
                    setHistory(p => [...p, { ...questions[currentQ], correct: data.correct }]);
                } catch (e) {}
            };
            
            const nextQuestion = () => { if (currentQ < questions.length - 1) { setCurrentQ(p => p + 1); setSelected(null); setResult(null); setTimeLeft(30); setTimerActive(true); } else { setMode('result'); } };

            if (mode === 'menu') {
                return (<div className="space-y-6"><h1 className="text-3xl font-bold">ğŸ“š æ•™è‚²ç³»çµ± - çŸ¥è­˜æŒ‘æˆ°</h1><div className="grid grid-cols-1 lg:grid-cols-2 gap-6"><div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700"><h2 className="text-xl font-semibold mb-4">ğŸ¯ é¸æ“‡ç§‘ç›®</h2><div className="grid grid-cols-2 gap-3">{subjects.map(s => (<button key={s.id} onClick={() => setSubject(s.id)} className={`p-4 rounded-lg border text-left ${subject === s.id ? 'bg-indigo-600 border-indigo-400' : 'bg-gray-900/50 border-gray-600 hover:border-indigo-500'}`}><span className="text-2xl mr-2">{s.icon}</span>{s.name}</button>))}</div></div><div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700"><h2 className="text-xl font-semibold mb-4">ğŸ“Š é¡Œæ•¸</h2><div className="flex gap-2 mb-4">{[5, 10, 15, 20].map(n => (<button key={n} onClick={() => setQuestionCount(n)} className={`px-4 py-2 rounded-lg ${questionCount === n ? 'bg-green-600' : 'bg-gray-700'}`}>{n} é¡Œ</button>))}</div><button onClick={loadQuestions} disabled={loading} className="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg font-bold text-lg">{loading ? 'è¼‰å…¥ä¸­...' : 'ğŸš€ é–‹å§‹æŒ‘æˆ°'}</button></div></div></div>);
            }

            if (mode === 'quiz') {
                const q = questions[currentQ]; if (!q) return <Loading />;
                const options = Array.isArray(q.options) ? q.options : [];
                return (<div className="space-y-6 max-w-3xl mx-auto"><div className="flex justify-between items-center"><button onClick={() => { setMode('menu'); setTimerActive(false); }} className="text-gray-400 hover:text-white">â† è¿”å›</button><div className="flex items-center gap-4">{score.streak >= 3 && <span className="text-orange-400 bounce">ğŸ”¥ {score.streak}</span>}<span className="text-green-400 font-bold">{score.correct}</span><span className="text-gray-500">/</span><span className="text-gray-400">{score.total}</span></div></div><div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700"><div className="mb-4"><div className="flex justify-between text-sm text-gray-400 mb-1"><span>é¡Œç›® {currentQ + 1} / {questions.length}</span><span className={timeLeft <= 10 ? 'text-red-400 font-bold' : ''}>{timeLeft}s</span></div><div className="bg-gray-700 rounded-full h-2 mb-1"><div className="bg-indigo-500 h-2 rounded-full progress-bar" style={{ width: `${((currentQ + 1) / questions.length) * 100}%` }}></div></div><div className="bg-gray-700 rounded-full h-1"><div className={`h-1 rounded-full progress-bar ${timeLeft <= 10 ? 'bg-red-500' : 'bg-green-500'}`} style={{ width: `${(timeLeft / 30) * 100}%` }}></div></div></div><div className="mb-2"><span className="text-sm text-indigo-400 bg-indigo-900/30 px-2 py-1 rounded">{q.subject || q.subject_id}</span></div><h2 className="text-xl mb-6">{q.question_text}</h2><div className="space-y-3">{options.map((opt, i) => { const letter = opt.charAt(0); const isSelected = selected === letter; const isCorrect = result?.correct_answer === letter; const isWrong = isSelected && !result?.correct; let btnClass = 'bg-gray-900/50 border-gray-600 hover:border-indigo-500'; if (result) { if (isCorrect) btnClass = 'bg-green-900/50 border-green-500 bounce'; else if (isWrong) btnClass = 'bg-red-900/50 border-red-500 shake'; else btnClass = 'bg-gray-900/50 border-gray-700 opacity-50'; } return (<button key={i} onClick={() => checkAnswer(letter)} disabled={result !== null} className={`w-full text-left p-4 rounded-lg border-2 transition-all ${btnClass}`}><span className="font-bold mr-2">{letter}.</span>{opt.substring(2)}</button>); })}</div>{result && (<div className={`mt-6 p-4 rounded-lg fade-in ${result.correct ? 'bg-green-900/30 border border-green-600' : 'bg-red-900/30 border border-red-600'}`}><div className="font-bold text-lg">{result.timeout ? 'â° æ™‚é–“åˆ°ï¼' : result.correct ? 'âœ… ç­”å°äº†ï¼' : 'âŒ ç­”éŒ¯äº†'}{!result.correct && <span className="ml-2 text-green-400">æ­£ç¢º: {result.correct_answer}</span>}</div>{q.explanation && <p className="text-gray-300 mt-2">{q.explanation}</p>}</div>)}{result && (<button onClick={nextQuestion} className="mt-4 w-full py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-semibold text-lg">{currentQ < questions.length - 1 ? 'ä¸‹ä¸€é¡Œ â†’' : 'æŸ¥çœ‹çµæœ ğŸ†'}</button>)}</div></div>);
            }

            if (mode === 'result') {
                const percentage = Math.round((score.correct / score.total) * 100);
                const grade = percentage >= 90 ? 'S' : percentage >= 80 ? 'A' : percentage >= 70 ? 'B' : percentage >= 60 ? 'C' : 'D';
                const gradeColors = { S: 'text-yellow-400', A: 'text-green-400', B: 'text-blue-400', C: 'text-orange-400', D: 'text-red-400' };
                return (<div className="space-y-6 max-w-2xl mx-auto"><div className="bg-gray-800/50 rounded-xl p-8 border border-gray-700 text-center"><div className="text-6xl mb-4">ğŸ‰</div><h1 className="text-3xl font-bold mb-2">æŒ‘æˆ°å®Œæˆï¼</h1><div className={`text-9xl font-bold my-6 ${gradeColors[grade]}`}>{grade}</div><div className="grid grid-cols-3 gap-4 mb-6"><div className="bg-gray-900/50 p-4 rounded-lg"><div className="text-3xl font-bold text-green-400">{score.correct}</div><div className="text-sm text-gray-500">ç­”å°</div></div><div className="bg-gray-900/50 p-4 rounded-lg"><div className="text-3xl font-bold">{percentage}%</div><div className="text-sm text-gray-500">æ­£ç¢ºç‡</div></div><div className="bg-gray-900/50 p-4 rounded-lg"><div className="text-3xl font-bold text-orange-400">{score.maxStreak}</div><div className="text-sm text-gray-500">æœ€é«˜é€£å‹</div></div></div><div className="flex gap-4 justify-center"><button onClick={() => setMode('menu')} className="px-6 py-3 bg-gray-700 rounded-lg">è¿”å›</button><button onClick={loadQuestions} className="px-6 py-3 bg-indigo-600 rounded-lg">å†ç©ä¸€æ¬¡</button></div></div></div>);
            }
        };
        
        const Trade = () => {
            const [strategies, setStrategies] = useState([]);
            const [indicators, setIndicators] = useState([]);
            const [tab, setTab] = useState('strategies');
            const [loading, setLoading] = useState(true);
            const [selectedItem, setSelectedItem] = useState(null);
            const [modalOpen, setModalOpen] = useState(false);
            useEffect(() => { Promise.all([fetch(`${API_BASE}/api/v1/trade/strategies`).then(r => r.json()), fetch(`${API_BASE}/api/v1/trade/indicators`).then(r => r.json())]).then(([s, i]) => { setStrategies(s.strategies || []); setIndicators(i.indicators || []); setLoading(false); }).catch(() => setLoading(false)); }, []);
            if (loading) return <Loading />;
            return (<div className="space-y-6"><h1 className="text-3xl font-bold">ğŸ“ˆ äº¤æ˜“ç³»çµ±</h1><div className="grid grid-cols-1 md:grid-cols-4 gap-4"><StatCard title="ç­–ç•¥æ•¸" value={strategies.length} icon="ğŸ“Š" /><StatCard title="æŒ‡æ¨™æ•¸" value={indicators.length} icon="ğŸ“‰" /><StatCard title="å›æ¸¬" value="5" icon="ğŸ§ª" /><StatCard title="æˆç†Ÿåº¦" value="90.2%" icon="ğŸ¯" /></div><div className="flex gap-2"><button onClick={() => setTab('strategies')} className={`px-4 py-2 rounded-lg ${tab === 'strategies' ? 'bg-indigo-600' : 'bg-gray-800'}`}>ğŸ“Š ç­–ç•¥ ({strategies.length})</button><button onClick={() => setTab('indicators')} className={`px-4 py-2 rounded-lg ${tab === 'indicators' ? 'bg-indigo-600' : 'bg-gray-800'}`}>ğŸ“‰ æŒ‡æ¨™ ({indicators.length})</button></div>{tab === 'strategies' && (<div className="grid grid-cols-1 md:grid-cols-2 gap-4">{strategies.map((s, i) => (<div key={i} onClick={() => { setSelectedItem({...s, type: 'strategy'}); setModalOpen(true); }} className="bg-gray-800/50 rounded-xl p-4 border border-gray-700 hover:border-indigo-500 cursor-pointer"><h3 className="font-bold text-indigo-400">{s.strategy_name || s.name}</h3><p className="text-sm text-gray-400 mt-1">{s.description?.substring(0, 80)}...</p></div>))}</div>)}{tab === 'indicators' && (<div className="grid grid-cols-1 md:grid-cols-3 gap-4">{indicators.map((ind, i) => (<div key={i} onClick={() => { setSelectedItem({...ind, type: 'indicator'}); setModalOpen(true); }} className="bg-gray-800/50 rounded-xl p-4 border border-gray-700 hover:border-green-500 cursor-pointer"><h3 className="font-bold text-green-400">{ind.indicator_name || ind.name}</h3>{ind.formula && <code className="block mt-2 text-xs bg-gray-900 p-2 rounded">{ind.formula?.substring(0, 40)}...</code>}</div>))}</div>)}<Modal isOpen={modalOpen} onClose={() => setModalOpen(false)} title={selectedItem?.type === 'strategy' ? 'ğŸ“Š ç­–ç•¥è©³æƒ…' : 'ğŸ“‰ æŒ‡æ¨™è©³æƒ…'}>{selectedItem && (<div className="space-y-4"><h3 className="text-xl font-bold text-indigo-400">{selectedItem.strategy_name || selectedItem.indicator_name || selectedItem.name}</h3>{selectedItem.description && <p>{selectedItem.description}</p>}{selectedItem.formula && <div><h4 className="font-semibold text-gray-400">å…¬å¼</h4><code className="block bg-gray-900 p-3 rounded">{selectedItem.formula}</code></div>}{selectedItem.interpretation && <div><h4 className="font-semibold text-gray-400">è§£è®€</h4><p>{selectedItem.interpretation}</p></div>}</div>)}</Modal></div>);
        };
        
        const VirtualEarth = () => {
            const [tab, setTab] = useState('game');
            const [currentScenario, setCurrentScenario] = useState(null);
            const [scenarioResult, setScenarioResult] = useState(null);
            const [player, setPlayer] = useState({ gold: 500, exp: 0, level: 1, hp: 100, maxHp: 100, completed: [] });
            const [modalOpen, setModalOpen] = useState(false);
            const [modalContent, setModalContent] = useState(null);

            const scenarios = [
                { id: 'S001', title: 'ç¥ç§˜æŠ•è³‡æ©Ÿæœƒ', difficulty: 'ç°¡å–®', description: 'ä½ æ”¶åˆ°è¨Šæ¯ï¼šã€Œç¨å®¶å…§ç·šï¼ä¿è­‰å ±é…¬50%ï¼åªé™ä»Šå¤©ï¼ã€', options: [{ id: 'A', text: 'ç«‹å³åŒ¯æ¬¾æŠ•è³‡', correct: false, feedback: 'âŒ é€™æ˜¯æŠ•è³‡è©é¨™ï¼ã€Œä¿è­‰ç²åˆ©ã€æ˜¯æœ€å¤§è­¦è¨Šã€‚' }, { id: 'B', text: 'å…ˆæŸ¥è­‰å°æ–¹èº«ä»½', correct: true, feedback: 'âœ… æ­£ç¢ºï¼æ°¸é è¦å…ˆæŸ¥è­‰ï¼Œå¯ä¸Šé‡‘ç®¡æœƒç¶²ç«™ç¢ºèªã€‚' }, { id: 'C', text: 'å°é¡è©¦è©¦', correct: false, feedback: 'âŒ è©é¨™æœƒè®“ä½ å…ˆè³ºï¼Œå†é¨™æ›´å¤šï¼' }, { id: 'D', text: 'å•æœ‹å‹', correct: false, feedback: 'âŒ æœƒå®³æœ‹å‹ä¸€èµ·è¢«é¨™ã€‚' }], exp: 100, gold: 50 },
                { id: 'S002', title: 'å‡å†’éŠ€è¡Œä¾†é›»', difficulty: 'ç°¡å–®', description: 'ã€Œæˆ‘æ˜¯éŠ€è¡Œé¢¨æ§ï¼Œæ‚¨å¸³æˆ¶ç•°å¸¸ï¼Œè«‹æä¾›å¯†ç¢¼é©—è­‰ã€‚ã€', options: [{ id: 'A', text: 'æä¾›å¯†ç¢¼', correct: false, feedback: 'âŒ éŠ€è¡Œçµ•ä¸æœƒè¦å¯†ç¢¼ï¼' }, { id: 'B', text: 'æ›æ–·ï¼Œè‡ªå·±æ‰“å®¢æœ', correct: true, feedback: 'âœ… æ­£ç¢ºï¼æ°¸é è‡ªå·±æ’¥æ‰“å®˜æ–¹é›»è©±ç¢ºèªã€‚' }, { id: 'C', text: 'è«‹å°æ–¹è­‰æ˜èº«ä»½', correct: false, feedback: 'âŒ è­‰ä»¶å¯å½é€ ã€‚' }, { id: 'D', text: 'æä¾›ä¸€åŠå¯†ç¢¼', correct: false, feedback: 'âŒ ä»»ä½•å¯†ç¢¼éƒ½ä¸èƒ½èªªï¼' }], exp: 100, gold: 50 },
                { id: 'S003', title: 'ç¶²è³¼è¶…ä½åƒ¹', difficulty: 'ä¸­ç­‰', description: 'åç‰ŒåŒ…åªè¦1/10åƒ¹æ ¼ï¼Œè³£å®¶èªªæ˜¯ã€Œå“¡å·¥å…§è³¼åƒ¹ã€ï¼Œè¦ç§ä¸‹è½‰å¸³ã€‚', options: [{ id: 'A', text: 'ç›´æ¥åŒ¯æ¬¾', correct: false, feedback: 'âŒ ç§ä¸‹è½‰å¸³æ²’ä¿éšœï¼' }, { id: 'B', text: 'è¦æ±‚ç”¨è¦çš®äº¤æ˜“', correct: true, feedback: 'âœ… æ­£ç¢ºï¼ä½¿ç”¨æœ‰ä¿éšœçš„å¹³å°ã€‚' }, { id: 'C', text: 'è¦æ±‚æ›´å¤šç…§ç‰‡', correct: false, feedback: 'âŒ ç…§ç‰‡å¯ç›œåœ–ã€‚' }, { id: 'D', text: 'ä»˜ä¸€åŠè¨‚é‡‘', correct: false, feedback: 'âŒ è¨‚é‡‘æ‹¿ä¸å›ä¾†ï¼' }], exp: 150, gold: 80 },
                { id: 'S004', title: 'äº¤å‹è»Ÿé«”å€ŸéŒ¢', difficulty: 'å›°é›£', description: 'èªè­˜ä¸€å€‹æœˆçš„å°è±¡èªªåª½åª½ä½é™¢ï¼Œéœ€è¦å€Ÿ5è¬ã€‚', options: [{ id: 'A', text: 'å€Ÿçµ¦ä»–', correct: false, feedback: 'âŒ é€™æ˜¯ã€Œæ®ºè±¬ç›¤ã€æ„›æƒ…è©é¨™ï¼' }, { id: 'B', text: 'è¦æ±‚è¦–è¨Šç¢ºèª', correct: true, feedback: 'âœ… æ­£ç¢ºï¼æ„›æƒ…è©é¨™è€…æœƒæ‹’çµ•è¦–è¨Šã€‚' }, { id: 'C', text: 'å€Ÿå°ç­†', correct: false, feedback: 'âŒ æœƒæœ‰æ›´å¤šã€Œç·Šæ€¥ç‹€æ³ã€ã€‚' }, { id: 'D', text: 'è¦æ±‚é†«ç™‚è­‰æ˜', correct: false, feedback: 'âŒ æ–‡ä»¶å¯å½é€ ã€‚' }], exp: 200, gold: 120 },
                { id: 'S005', title: 'ä¸­çç°¡è¨Š', difficulty: 'ç°¡å–®', description: 'ã€Œæ­å–œæŠ½ä¸­iPhoneï¼ä»˜399é‹è²»å³å¯é ˜å–ï¼ã€', options: [{ id: 'A', text: 'é»é€£çµä»˜æ¬¾', correct: false, feedback: 'âŒ é€™æ˜¯é ä»˜è²»è©é¨™ï¼' }, { id: 'B', text: 'ç¢ºèªæœ‰æ²’æœ‰åƒåŠ æŠ½ç', correct: true, feedback: 'âœ… æ­£ç¢ºï¼æ²’åƒåŠ çš„ä¸å¯èƒ½ä¸­çã€‚' }, { id: 'C', text: 'å›è¦†è©¢å•', correct: false, feedback: 'âŒ æœƒæš´éœ²æœ‰æ•ˆè™Ÿç¢¼ã€‚' }, { id: 'D', text: 'è½‰ç™¼æœ‹å‹', correct: false, feedback: 'âŒ æœƒå®³æœ‹å‹è¢«é¨™ï¼' }], exp: 80, gold: 40 }
            ];

            const startScenario = (s) => { setCurrentScenario(s); setScenarioResult(null); setTab('playing'); };
            const answerScenario = (opt) => { setScenarioResult(opt); if (opt.correct) { setPlayer(p => ({ ...p, exp: p.exp + currentScenario.exp, gold: p.gold + currentScenario.gold, level: Math.floor((p.exp + currentScenario.exp) / 300) + 1, completed: [...p.completed, currentScenario.id] })); } else { setPlayer(p => ({ ...p, hp: Math.max(0, p.hp - 20), exp: p.exp + 20 })); } };
            const nextScenario = () => { const idx = scenarios.findIndex(s => s.id === currentScenario.id); if (idx < scenarios.length - 1) { startScenario(scenarios[idx + 1]); } else { setTab('game'); setCurrentScenario(null); } };

            const PlayerStatus = () => (<div className="bg-gradient-to-r from-indigo-900/50 to-purple-900/50 rounded-xl p-4 border border-indigo-500 mb-6"><div className="flex flex-wrap items-center justify-between gap-4"><div className="flex items-center gap-3"><div className="w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center text-2xl">ğŸ§™</div><div><div className="text-sm text-gray-400">é˜²è©å‹‡å£«</div><div className="font-bold text-xl">Lv.{player.level}</div></div></div><div className="flex gap-6"><div className="text-center"><div className="text-red-400 font-bold">â¤ï¸ {player.hp}/{player.maxHp}</div><div className="text-xs text-gray-500">ç”Ÿå‘½</div></div><div className="text-center"><div className="text-yellow-400 font-bold">ğŸ’° {player.gold}</div><div className="text-xs text-gray-500">é‡‘å¹£</div></div><div className="text-center"><div className="text-green-400 font-bold">â­ {player.exp}</div><div className="text-xs text-gray-500">ç¶“é©—</div></div><div className="text-center"><div className="text-blue-400 font-bold">ğŸ¯ {player.completed.length}/{scenarios.length}</div><div className="text-xs text-gray-500">å®Œæˆ</div></div></div></div><div className="mt-3 grid grid-cols-2 gap-2"><div><div className="text-xs text-gray-500 mb-1">HP</div><div className="bg-gray-700 rounded-full h-2"><div className="bg-red-500 h-2 rounded-full progress-bar" style={{ width: `${(player.hp / player.maxHp) * 100}%` }}></div></div></div><div><div className="text-xs text-gray-500 mb-1">EXP ({player.exp % 300}/300)</div><div className="bg-gray-700 rounded-full h-2"><div className="bg-green-500 h-2 rounded-full progress-bar" style={{ width: `${(player.exp % 300) / 3}%` }}></div></div></div></div></div>);

            if (tab === 'playing' && currentScenario) {
                return (<div className="space-y-6 max-w-3xl mx-auto"><PlayerStatus /><div className="bg-gray-800/50 rounded-xl border border-gray-700 overflow-hidden"><div className="bg-gradient-to-r from-red-600 to-orange-600 p-4"><div className="flex justify-between"><h2 className="text-xl font-bold">ğŸš¨ {currentScenario.title}</h2><span className={`px-3 py-1 rounded-full text-sm ${currentScenario.difficulty === 'ç°¡å–®' ? 'bg-green-900 text-green-300' : currentScenario.difficulty === 'ä¸­ç­‰' ? 'bg-yellow-900 text-yellow-300' : 'bg-red-900 text-red-300'}`}>{currentScenario.difficulty}</span></div></div><div className="p-6"><div className="bg-gray-900/50 rounded-lg p-4 mb-6 border-l-4 border-yellow-500"><p className="text-lg">{currentScenario.description}</p></div><h3 className="font-semibold mb-4 text-gray-300">ä½ æœƒæ€éº¼åšï¼Ÿ</h3><div className="space-y-3">{currentScenario.options?.map((opt, i) => { const isSelected = scenarioResult?.id === opt.id; const showResult = scenarioResult !== null; let btnClass = 'bg-gray-900/50 border-gray-600 hover:border-indigo-500'; if (showResult) { if (opt.correct) btnClass = 'bg-green-900/50 border-green-500'; else if (isSelected) btnClass = 'bg-red-900/50 border-red-500 shake'; else btnClass = 'bg-gray-900/50 border-gray-700 opacity-50'; } return (<button key={i} onClick={() => !scenarioResult && answerScenario(opt)} disabled={scenarioResult !== null} className={`w-full text-left p-4 rounded-lg border-2 transition-all ${btnClass}`}><span className="font-bold text-indigo-400 mr-2">{opt.id}.</span>{opt.text}</button>); })}</div>{scenarioResult && (<div className={`mt-6 p-4 rounded-lg fade-in ${scenarioResult.correct ? 'bg-green-900/30 border border-green-600' : 'bg-red-900/30 border border-red-600'}`}><p className="text-lg">{scenarioResult.feedback}</p>{scenarioResult.correct && (<div className="mt-3 flex gap-4 text-sm"><span className="text-green-400">ğŸ† +{currentScenario.exp} EXP</span><span className="text-yellow-400">ğŸ’° +{currentScenario.gold}</span></div>)}{!scenarioResult.correct && (<div className="mt-3 text-sm text-red-400">â¤ï¸ -20 HP | â­ +20 EXP</div>)}</div>)}{scenarioResult && (<div className="mt-6 flex gap-4"><button onClick={() => { setTab('game'); setCurrentScenario(null); }} className="flex-1 py-3 bg-gray-700 rounded-lg">è¿”å›</button><button onClick={nextScenario} className="flex-1 py-3 bg-indigo-600 rounded-lg font-semibold">{scenarios.findIndex(s => s.id === currentScenario.id) < scenarios.length - 1 ? 'ä¸‹ä¸€é—œ â†’' : 'å®Œæˆ'}</button></div>)}</div></div></div>);
            }

            return (<div className="space-y-6"><h1 className="text-3xl font-bold">ğŸŒ è™›æ“¬åœ°çƒ - E18K é˜²è©éŠæˆ²</h1><PlayerStatus /><div className="flex gap-2"><button onClick={() => setTab('game')} className={`px-4 py-2 rounded-lg ${tab === 'game' ? 'bg-indigo-600' : 'bg-gray-800'}`}>ğŸ® éŠæˆ²é—œå¡</button><button onClick={() => setTab('tips')} className={`px-4 py-2 rounded-lg ${tab === 'tips' ? 'bg-indigo-600' : 'bg-gray-800'}`}>ğŸ“– é˜²è©å°çŸ¥è­˜</button></div>{tab === 'game' && (<div className="space-y-4"><div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700"><h2 className="text-xl font-semibold mb-2">ğŸ¯ é˜²è©æƒ…å¢ƒæŒ‘æˆ°</h2><p className="text-gray-400 mb-4">é¢å°å„ç¨®è©é¨™æƒ…å¢ƒï¼Œåšå‡ºæ­£ç¢ºåˆ¤æ–·ï¼ç­”å°ç²å¾—çå‹µï¼Œç­”éŒ¯æ‰£è¡€é‡ã€‚</p><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">{scenarios.map((s, i) => { const isCompleted = player.completed.includes(s.id); return (<div key={i} className={`bg-gray-900/50 rounded-lg p-4 border ${isCompleted ? 'border-green-600' : 'border-gray-600'}`}><div className="flex justify-between mb-2"><h3 className="font-bold text-indigo-400">{s.title}</h3>{isCompleted && <span className="text-green-400">âœ…</span>}</div><span className={`text-xs px-2 py-1 rounded ${s.difficulty === 'ç°¡å–®' ? 'bg-green-900/50 text-green-400' : s.difficulty === 'ä¸­ç­‰' ? 'bg-yellow-900/50 text-yellow-400' : 'bg-red-900/50 text-red-400'}`}>{s.difficulty}</span><p className="text-sm text-gray-400 mt-2">{s.description?.substring(0, 40)}...</p><div className="mt-3 flex justify-between items-center"><div className="text-xs text-gray-500">ğŸ† {s.exp} | ğŸ’° {s.gold}</div><button onClick={() => startScenario(s)} className={`px-3 py-1 rounded text-sm ${isCompleted ? 'bg-gray-700' : 'bg-indigo-600'}`}>{isCompleted ? 'é‡ç©' : 'æŒ‘æˆ°'}</button></div></div>); })}</div></div></div>)}{tab === 'tips' && (<div className="bg-gray-800/50 rounded-xl p-6 border border-gray-700"><h2 className="text-xl font-semibold mb-4">ğŸ“– é˜²è©å°çŸ¥è­˜</h2><div className="grid grid-cols-1 md:grid-cols-2 gap-4"><div className="bg-gray-900/50 p-4 rounded-lg border-l-4 border-red-500"><h3 className="font-bold text-red-400 mb-2">ğŸš« è©é¨™å¸¸è¦‹æ‰‹æ³•</h3><ul className="text-sm text-gray-400 space-y-1"><li>â€¢ æŠ•è³‡è©é¨™ï¼šä¿è­‰ç²åˆ©ã€ç©©è³ºä¸è³ </li><li>â€¢ å‡å†’èº«ä»½ï¼šéŠ€è¡Œã€è­¦å¯Ÿã€æ³•é™¢</li><li>â€¢ ç¶²è³¼è©é¨™ï¼šåƒ¹æ ¼éä½ã€ç§ä¸‹äº¤æ˜“</li><li>â€¢ æ„›æƒ…è©é¨™ï¼šç¶²è·¯äº¤å‹ã€å€ŸéŒ¢æ€¥ç”¨</li></ul></div><div className="bg-gray-900/50 p-4 rounded-lg border-l-4 border-green-500"><h3 className="font-bold text-green-400 mb-2">âœ… é˜²è©ä¸‰è¦è¨£</h3><ul className="text-sm text-gray-400 space-y-1"><li>â€¢ <strong>å†·éœ</strong>ï¼šä¸æ€¥è‘—åšæ±ºå®š</li><li>â€¢ <strong>æŸ¥è­‰</strong>ï¼šè‡ªå·±æ‰“é›»è©±ç¢ºèª</li><li>â€¢ <strong>æ±‚åŠ©</strong>ï¼šæ’¥æ‰“165åè©é¨™å°ˆç·š</li><li>â€¢ è¨˜ä½ï¼šå¤©ä¸‹æ²’æœ‰ç™½åƒçš„åˆé¤ï¼</li></ul></div></div></div>)}</div>);
        };
        
        const App = () => {
            const [currentPage, setCurrentPage] = useState('dashboard');
            const renderPage = () => { switch (currentPage) { case 'dashboard': return <Dashboard />; case 'qixing': return <QiXing />; case 'databases': return <Databases />; case 'trade': return <Trade />; case 'education': return <Education />; case 've': return <VirtualEarth />; default: return <Dashboard />; } };
            return (<div className="min-h-screen"><Navbar currentPage={currentPage} setCurrentPage={setCurrentPage} /><main className="max-w-7xl mx-auto px-4 py-8">{renderPage()}</main><footer className="text-center py-6 text-gray-500 text-sm border-t border-gray-800"><p>VE-System v1.0.0 | åŒ—æ–—ä¸ƒæ˜Ÿæ–‡å‰µæ•¸ä½æœ‰é™å…¬å¸</p><p className="mt-1">é“çš„1%åŸå‰‡ Â· æ—¥æ‹±ä¸€å’</p></footer></div>);
        };
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>